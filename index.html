<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimePro v1.2 | Modo Paliativo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto:wght@400;700&display=swap');
        
        :root {
            --primary: #F47521;
            --bg: #050505;
            --surface: #121212;
            --text: #ffffff;
            --fav-color: #ff4757;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', sans-serif; background: var(--bg); color: var(--text); }

        /* HEADER */
        header {
            padding: 15px 5%;
            background: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0; z-index: 1000;
            border-bottom: 2px solid var(--primary);
        }

        .logo { font-family: 'Oswald', sans-serif; font-size: 32px; color: var(--primary); font-weight: 700; cursor:pointer; }
        .search-bar { background: #222; border-radius: 20px; padding: 8px 20px; display: flex; width: 100%; max-width: 350px; }
        .search-bar input { background: none; border: none; color: white; width: 100%; outline: none; }

        /* FILTROS */
        .filters { background: #111; padding: 10px 5%; border-bottom: 1px solid #222; }
        .tabs { display: flex; gap: 20px; justify-content: center; margin-bottom: 10px; }
        .tabs button { background: none; border: none; color: #888; font-family: 'Oswald'; font-size: 16px; cursor: pointer; }
        .tabs button.active { color: var(--primary); border-bottom: 2px solid var(--primary); }
        
        .alphabet { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; }
        .alphabet button { background: #222; border: none; color: white; min-width: 25px; height: 25px; border-radius: 3px; cursor: pointer; font-size: 11px; }
        .alphabet button:hover { background: var(--primary); }

        /* GRID */
        .grid { display: grid; padding: 20px 5%; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
        .card { background: var(--surface); border-radius: 8px; overflow: hidden; transition: 0.3s; cursor: pointer; position: relative; border: 1px solid #222; }
        .card:hover { transform: scale(1.05); border-color: var(--primary); }
        .card img { width: 100%; height: 220px; object-fit: cover; }
        .card-info { padding: 10px; text-align: center; }
        .card-info h3 { font-size: 13px; font-weight: 700; height: 32px; overflow: hidden; }

        /* BOTÃO FAVORITO NO CARD */
        .fav-btn-card { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; color: white; border: none; }
        .fav-btn-card.active { color: var(--fav-color); }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 2000; overflow-y: auto; padding: 20px; }
        .modal-content { max-width: 1000px; margin: auto; }
        .video-box { width: 100%; aspect-ratio: 16/9; background: #000; border: 2px solid #222; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }
        
        .ep-list { margin-top: 20px; background: #111; padding: 20px; border-radius: 8px; }
        .ep-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 8px; margin-top: 15px; }
        .ep-item { background: #222; padding: 10px; text-align: center; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .ep-item:hover { background: var(--primary); }
        .close-modal { float: right; font-size: 35px; color: var(--primary); cursor: pointer; }
        
        #reader-view { display: none; background: #fff; height: 100%; overflow-y: auto; text-align: center; }
        #reader-view img { max-width: 100%; display: block; margin: 0 auto 10px; }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="window.location.reload()">ANIME<span>PRO</span></div>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Pesquisar..." oninput="debounceSearch()">
    </div>
</header>

<div class="filters">
    <div class="tabs">
        <button id="tab-anime" class="active" onclick="changeTab('anime')">ANIMES</button>
        <button id="tab-manga" onclick="changeTab('manga')">MANGÁS</button>
        <button id="tab-manhwa" onclick="changeTab('manhwa')">MANHWAS</button>
        <button id="tab-fav" onclick="showFavs()">MINHA LISTA ❤️</button>
    </div>
    <div class="alphabet" id="alphabet"></div>
</div>

<div class="grid" id="mainGrid"></div>

<div id="mainModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle" style="margin-bottom: 15px;">Título</h2>
        <div class="video-box">
            <iframe id="mainPlayer" src="" allowfullscreen></iframe>
            <div id="reader-view"></div>
        </div>
        <div class="ep-list">
            <h3 id="labelType">Episódios</h3>
            <div class="ep-grid" id="epGrid"></div>
        </div>
    </div>
</div>

<script>
    let currentTab = 'anime';
    let searchTimeout;
    let favorites = JSON.parse(localStorage.getItem('animeFavs')) || [];

    // Gerar Alfabeto
    const alphaDiv = document.getElementById('alphabet');
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l => {
        alphaDiv.innerHTML += `<button onclick="loadData('', '${l}')">${l}</button>`;
    });

    async function loadData(query = '', letter = '') {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = "<p style='grid-column: 1/-1; text-align:center;'>Carregando...</p>";
        
        let url = `https://api.jikan.moe/v4/${currentTab === 'anime' ? 'anime' : 'manga'}?order_by=popularity&limit=24`;
        if(query) url += `&q=${query}`;
        if(letter) url += `&letter=${letter}`;
        if(currentTab === 'manhwa') url = `https://api.jikan.moe/v4/manga?q=manhwa&order_by=popularity&limit=24${letter ? '&letter='+letter : ''}`;

        try {
            const resp = await fetch(url);
            const data = await resp.json();
            render(data.data);
        } catch (e) { grid.innerHTML = "Erro de conexão."; }
    }

    function render(items) {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = items.map(item => {
            const isFav = favorites.some(f => f.mal_id === item.mal_id);
            return `
            <div class="card">
                <button class="fav-btn-card ${isFav ? 'active' : ''}" onclick="toggleFav(event, ${JSON.stringify(item).replace(/'/g, "&apos;")})">❤</button>
                <div onclick='openDetails(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                    <img src="${item.images.jpg.image_url}" loading="lazy">
                    <div class="card-info"><h3>${item.title}</h3></div>
                </div>
            </div>
        `}).join('');
    }

    function toggleFav(e, item) {
        e.stopPropagation();
        const index = favorites.findIndex(f => f.mal_id === item.mal_id);
        if(index > -1) favorites.splice(index, 1);
        else favorites.push(item);
        localStorage.setItem('animeFavs', JSON.stringify(favorites));
        if(currentTab === 'fav') showFavs();
        else loadData();
    }

    function showFavs() {
        currentTab = 'fav';
        document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-fav').classList.add('active');
        render(favorites);
    }

    function changeTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById(`tab-${tab}`).classList.add('active');
        loadData();
    }

    function openDetails(item) {
        document.getElementById('modalTitle').innerText = item.title;
        document.getElementById('mainModal').style.display = 'block';
        const isManga = currentTab !== 'anime' && currentTab !== 'fav';
        document.getElementById('labelType').innerText = isManga ? "Capítulos" : "Episódios";
        
        const epGrid = document.getElementById('epGrid');
        epGrid.innerHTML = "";
        const total = isManga ? (item.chapters || 30) : (item.episodes || 12);

        for(let i=1; i<=total; i++) {
            const div = document.createElement('div');
            div.className = 'ep-item';
            div.innerText = i;
            div.onclick = () => isManga ? loadManga(i) : loadVideo(item.title, i);
            epGrid.appendChild(div);
        }
    }

    // Lógica Paliativa de Vídeo
    function loadVideo(title, ep) {
        const player = document.getElementById('mainPlayer');
        player.style.display = 'block';
        document.getElementById('reader-view').style.display = 'none';
        
        // Tentativa de buscar em agregador externo usando o nome (Solução Paliativa)
        // Muitos agregadores usam o título do MyAnimeList para organizar
        const searchTitle = title.replace(/\s+/g, '-').toLowerCase();
        
        // Exemplo de link que sites de animes costumam usar (ajustável)
        // player.src = `https://supervideo.tv/e/anime/${searchTitle}/${ep}`;
        
        // Como estamos em teste, vamos usar um embed de player genérico que avisa que está buscando
        player.src = `https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1`;
        alert(`Buscando Episódio ${ep} de ${title} em servidores externos...`);
    }

    function loadManga(num) {
        document.getElementById('mainPlayer').style.display = 'none';
        const reader = document.getElementById('reader-view');
        reader.style.display = 'block';
        reader.innerHTML = `<h3>Capítulo ${num}</h3><img src="https://via.placeholder.com/800x1200.png?text=Carregando+Paginas+do+Capitulo+${num}" style="width:100%">`;
    }

    function closeModal() {
        document.getElementById('mainModal').style.display = 'none';
        document.getElementById('mainPlayer').src = "";
    }

    function debounceSearch() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => loadData(document.getElementById('searchInput').value), 800);
    }

    loadData();
</script>
</body>
</html>