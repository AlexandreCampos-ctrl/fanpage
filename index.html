<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnimePro | Projeto Profissional</title>

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#F47521;
  --bg:#050505;
  --card:#121212;
  --text:#fff;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Poppins;background:var(--bg);color:var(--text)}

/* HUB */
#hub{
  position:fixed;inset:0;z-index:999;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  background:linear-gradient(rgba(0,0,0,.8),rgba(0,0,0,.9)),
  url('https://images8.alphacoders.com/632/632124.png') center/cover;
}
#hub button{
  margin-top:30px;padding:20px 60px;
  font-family:Oswald;font-size:1.5rem;
  border:2px solid var(--primary);
  background:rgba(0,0,0,.6);color:#fff;
  border-radius:15px;cursor:pointer;
}

/* NAV */
nav{
  display:flex;align-items:center;gap:25px;
  padding:15px 5%;background:#000;
  border-bottom:2px solid var(--primary);
}
.logo{font-family:Oswald;font-size:2rem;color:var(--primary)}
.menu{list-style:none;display:flex;gap:20px}
.menu li{cursor:pointer;position:relative}
.submenu{
  display:none;position:absolute;top:30px;
  background:#111;padding:10px;border-radius:10px;
}
.menu li:hover .submenu{display:block}
.submenu li{padding:6px 12px;white-space:nowrap}

.hamburger{display:none;font-size:2rem;cursor:pointer}
input{margin-left:auto;padding:8px 15px;border-radius:20px;border:none;background:#222;color:#fff}

/* HERO */
.hero{
  height:420px;display:flex;
  align-items:flex-end;padding:40px 5%;
  background-size:cover;background-position:center;
}
.hero h1{font-family:Oswald;font-size:3rem}

/* GRID */
.container{padding:40px 5%}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:25px;
}
.card{
  background:var(--card);border-radius:10px;
  overflow:hidden;cursor:pointer;
  border:1px solid #222;transition:.3s;
}
.card:hover{transform:scale(1.05);border-color:var(--primary)}
.card img{width:100%;height:280px;object-fit:cover}
.card-title{text-align:center;padding:12px;font-size:.9rem}
.fav{color:gold;font-size:1.2rem}

/* MODAL */
.modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.95);
  z-index:3000;padding:40px 20px;
}
.modal-content{max-width:900px;margin:auto;text-align:center}
.player{aspect-ratio:16/9;border-radius:20px;overflow:hidden;margin:20px 0}

/* MOBILE */
@media(max-width:768px){
  .menu{display:none;flex-direction:column;background:#000;
    position:absolute;top:60px;left:0;width:100%;padding:20px}
  .menu.show{display:flex}
  input{width:100%;margin:10px 0}
  .hamburger{display:block}
}
</style>
</head>

<body>

<!-- HUB -->
<div id="hub">
  <h1 style="font-family:Oswald;color:var(--primary);font-size:4rem">ANIMEPRO</h1>
  <button onclick="start()">ENTRAR</button>
</div>

<!-- SITE -->
<div id="site" style="display:none">
<nav>
  <div class="logo">ANIMEPRO</div>
  <div class="hamburger" id="hamburger">☰</div>

  <ul class="menu" id="menu">
    <li data-route="home">Início</li>
    <li data-route="favorites">Favoritos</li>
    <li>Gêneros ▾
      <ul class="submenu" id="genreMenu"></ul>
    </li>
  </ul>

  <input id="search" placeholder="Buscar anime...">
</nav>

<div class="hero" id="hero">
  <h1 id="heroTitle"></h1>
</div>

<div class="container">
  <div class="grid" id="grid"></div>
</div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2 id="modalTitle"></h2>
    <div class="player" id="player"></div>
  </div>
</div>

<script>
const app={
  data:[],
  favorites:JSON.parse(localStorage.getItem('favorites'))||[],
  selected:null
};

const hub=document.getElementById('hub');
const site=document.getElementById('site');
const grid=document.getElementById('grid');
const modal=document.getElementById('modal');

/* START */
function start(){
  hub.style.display='none';
  site.style.display='block';
  loadGenres();
  route();
}

/* ROUTER */
window.onhashchange=route;
function route(){
  const r=location.hash.replace('#','')||'home';
  if(r==='favorites')loadFavorites();
  else loadTop();
}

/* MENU */
document.getElementById('hamburger').onclick=()=>{
  document.getElementById('menu').classList.toggle('show');
};

document.querySelectorAll('[data-route]').forEach(i=>{
  i.onclick=()=>location.hash=i.dataset.route;
});

/* API */
async function loadTop(){
  grid.innerHTML='Carregando...';
  const r=await fetch('https://api.jikan.moe/v4/top/anime');
  const j=await r.json();
  app.data=j.data;
  renderGrid();
  setHero(app.data[0]);
}

/* HERO */
function setHero(item){
  document.getElementById('hero').style.backgroundImage=
    `linear-gradient(to top,#050505,transparent),url(${item.images.jpg.large_image_url})`;
  document.getElementById('heroTitle').innerText=item.title;
}

/* GRID */
function renderGrid(){
  grid.innerHTML=app.data.map((a,i)=>`
    <div class="card" data-i="${i}">
      <img src="${a.images.jpg.large_image_url}">
      <div class="card-title">
        ${a.title}
        ${app.favorites.includes(a.mal_id)?'⭐':''}
      </div>
    </div>
  `).join('');

  document.querySelectorAll('.card').forEach(c=>{
    c.onclick=()=>openModal(c.dataset.i);
  });
}

/* MODAL */
function openModal(i){
  app.selected=app.data[i];
  modal.style.display='block';
  document.getElementById('modalTitle').innerHTML=
    `${app.selected.title}
    <span class="fav" onclick="toggleFav(${app.selected.mal_id})">★</span>`;
  loadPlayer(app.selected);
}

/* PLAYER */
function loadPlayer(item){
  const p=document.getElementById('player');
  const yt=item.trailer?.youtube_id;
  p.innerHTML=yt?
    `<iframe width="100%" height="100%" 
      src="https://www.youtube.com/embed/${yt}" allowfullscreen></iframe>`
    :'<p>Trailer não disponível.</p>';
}

/* FAVORITOS */
function toggleFav(id){
  if(app.favorites.includes(id))
    app.favorites=app.favorites.filter(f=>f!==id);
  else app.favorites.push(id);
  localStorage.setItem('favorites',JSON.stringify(app.favorites));
  alert('Favoritos atualizados');
}

async function loadFavorites(){
  grid.innerHTML='Carregando...';
  const results=[];
  for(let id of app.favorites){
    const r=await fetch(`https://api.jikan.moe/v4/anime/${id}`);
    const j=await r.json();
    results.push(j.data);
  }
  app.data=results;
  renderGrid();
}

/* GÊNEROS */
async function loadGenres(){
  const r=await fetch('https://api.jikan.moe/v4/genres/anime');
  const j=await r.json();
  document.getElementById('genreMenu').innerHTML=
    j.data.map(g=>`<li onclick="loadByGenre(${g.mal_id})">${g.name}</li>`).join('');
}

async function loadByGenre(id){
  grid.innerHTML='Carregando...';
  const r=await fetch(`https://api.jikan.moe/v4/anime?genres=${id}`);
  const j=await r.json();
  app.data=j.data;
  renderGrid();
}

/* SEARCH */
let t;
document.getElementById('search').oninput=e=>{
  clearTimeout(t);
  t=setTimeout(async()=>{
    if(!e.target.value)return loadTop();
    const r=await fetch(`https://api.jikan.moe/v4/anime?q=${e.target.value}`);
    const j=await r.json();
    app.data=j.data;
    renderGrid();
  },600);
};

/* FECHAR MODAL */
modal.onclick=e=>{if(e.target===modal)modal.style.display='none'};
document.onkeydown=e=>{if(e.key==='Escape')modal.style.display='none'};
</script>

</body>
</html>
